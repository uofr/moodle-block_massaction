{"version":3,"file":"massactionblock.min.js","sources":["../src/massactionblock.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main module for the massaction block.\n *\n * @module     block_massaction/massactionblock\n * @copyright  2022 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as checkboxmanager from './checkboxmanager';\nimport * as Str from 'core/str';\nimport Pending from 'core/pending';\nimport {getCurrentCourseEditor} from 'core_courseformat/courseeditor';\n\nexport const usedMoodleCssClasses = {\n    SECTION_NAME: 'sectionname',\n    MODULE_ID_PREFIX: 'module-',\n};\n\nexport const cssIds = {\n    SELECT_ALL_LINK: 'block-massaction-control-selectall',\n    DESELECT_ALL_LINK: 'block-massaction-control-deselectall',\n    HIDE_LINK: 'block-massaction-action-hide',\n    SHOW_LINK: 'block-massaction-action-show',\n    MAKE_AVAILABLE_LINK: 'block-massaction-action-makeavailable',\n    DUPLICATE_LINK: 'block-massaction-action-duplicate',\n    DELETE_LINK: 'block-massaction-action-delete',\n    MOVELEFT_LINK: 'block-massaction-action-moveleft',\n    MOVERIGHT_LINK: 'block-massaction-action-moveright',\n    MOVETO_ICON_LINK: 'block-massaction-action-moveto',\n    DUPLICATETO_ICON_LINK: 'block-massaction-action-duplicateto',\n    SECTION_SELECT: 'block-massaction-control-section-list-select',\n    MOVETO_SELECT: 'block-massaction-control-section-list-moveto',\n    DUPLICATETO_SELECT: 'block-massaction-control-section-list-duplicateto',\n    BOX_ID_PREFIX: 'block-massaction-module-selector-',\n    CHECKBOX_CLASS: 'block-massaction-checkbox',\n    HIDDEN_FIELD_REQUEST_INFORMATION: 'block-massaction-control-request',\n    ACTION_FORM: 'block-massaction-control-form',\n};\n\nexport const constants = {\n    SECTION_SELECT_DESCRIPTION_VALUE: 'description',\n    SECTION_NUMBER_ALL_PLACEHOLDER: 'all',\n    CHECKBOX_DESCRIPTION_SUFFIX: ' Checkbox'\n};\n\nconst actions = {\n    HIDE: 'hide',\n    SHOW: 'show',\n    MAKE_AVAILABLE: 'makeavailable',\n    DUPLICATE: 'duplicate',\n    DELETE: 'delete',\n    MOVE_LEFT: 'moveleft',\n    MOVE_RIGHT: 'moveright',\n    MOVE_TO: 'moveto',\n    DUPLICATE_TO: 'duplicateto',\n};\n\n/**\n * Initialize the mass-action block.\n */\nexport const init = async() => {\n    const pendingPromise = new Pending('block_massaction/init');\n\n    const editor = getCurrentCourseEditor();\n    // Initialize the checkbox manager as soon as the courseeditor is ready.\n    editor.stateManager.getInitialPromise().then(() => checkboxmanager.initCheckboxManager()).catch();\n\n    document.getElementById(cssIds.SELECT_ALL_LINK)?.addEventListener('click',\n        () => checkboxmanager.setSectionSelection(true, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.DESELECT_ALL_LINK)?.addEventListener('click',\n        () => checkboxmanager.setSectionSelection(false, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.HIDE_LINK)?.addEventListener('click',\n        () => submitAction(actions.HIDE), false);\n\n    document.getElementById(cssIds.SHOW_LINK)?.addEventListener('click',\n        () => submitAction(actions.SHOW), false);\n\n    document.getElementById(cssIds.MAKE_AVAILABLE_LINK)?.addEventListener('click',\n        () => submitAction(actions.MAKE_AVAILABLE), false);\n\n    document.getElementById(cssIds.DUPLICATE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE), false);\n\n    document.getElementById(cssIds.DELETE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DELETE), false);\n\n    document.getElementById(cssIds.MOVELEFT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_LEFT), false);\n\n    document.getElementById(cssIds.MOVERIGHT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_RIGHT), false);\n\n    document.getElementById(cssIds.MOVETO_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_TO), false);\n\n    document.getElementById(cssIds.DUPLICATETO_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE_TO), false);\n\n    pendingPromise.resolve();\n};\n\n/**\n * Submit the selected action to server.\n *\n * @param {string} action\n * @return {boolean} true if action was successful, false otherwise\n */\nconst submitAction = (action) => {\n    const submitData = {\n        'action': action,\n        'moduleIds': []\n    };\n\n    submitData.moduleIds = checkboxmanager.getSelectedModIds();\n\n    // Verify that at least one checkbox is checked.\n    if (submitData.moduleIds.length === 0) {\n        displayError(Str.get_string('noitemselected', 'block_massaction'));\n        return false;\n    }\n\n    // Prep the submission.\n    switch (action) {\n        case actions.HIDE:\n        case actions.SHOW:\n        case actions.MAKE_AVAILABLE:\n        case actions.DUPLICATE:\n        case actions.MOVE_LEFT:\n        case actions.MOVE_RIGHT:\n            break;\n\n        case actions.DELETE:\n            // Confirm.\n            break;\n\n        case actions.MOVE_TO:\n            // Get the target section.\n            submitData.moveToTarget = document.getElementById(cssIds.MOVETO_SELECT).value;\n            if (submitData.moveToTarget.trim() === '') {\n                displayError(Str.get_string('nomovingtargetselected', 'block_massaction'));\n                return false;\n            }\n            break;\n\n        case actions.DUPLICATE_TO:\n            // Get the target section.\n            submitData.duplicateToTarget = document.getElementById(cssIds.DUPLICATETO_SELECT).value;\n            if (submitData.duplicateToTarget.trim() === '') {\n                displayError(Str.get_string('nomovingtargetselected', 'block_massaction'));\n                return false;\n            }\n            break;\n        default:\n            displayError('Unknown action: ' + action + '. Coding error.');\n            return false;\n    }\n    // Set the form value and submit.\n    document.getElementById(cssIds.HIDDEN_FIELD_REQUEST_INFORMATION).value = JSON.stringify(submitData);\n    document.getElementById(cssIds.ACTION_FORM).submit();\n    return true;\n};\n\nconst displayError = (errorText) => {\n    Promise.resolve([Str.get_string('error', 'core'), errorText, Str.get_string('back', 'core')]).then(text => {\n        require(['core/notification'], function(notification) {\n            notification.alert(text[0], text[1], text[2]).then().catch();\n        });\n        return null;\n    }).catch();\n};\n"],"names":["SECTION_NAME","MODULE_ID_PREFIX","cssIds","SELECT_ALL_LINK","DESELECT_ALL_LINK","HIDE_LINK","SHOW_LINK","MAKE_AVAILABLE_LINK","DUPLICATE_LINK","DELETE_LINK","MOVELEFT_LINK","MOVERIGHT_LINK","MOVETO_ICON_LINK","DUPLICATETO_ICON_LINK","SECTION_SELECT","MOVETO_SELECT","DUPLICATETO_SELECT","BOX_ID_PREFIX","CHECKBOX_CLASS","HIDDEN_FIELD_REQUEST_INFORMATION","ACTION_FORM","constants","SECTION_SELECT_DESCRIPTION_VALUE","SECTION_NUMBER_ALL_PLACEHOLDER","CHECKBOX_DESCRIPTION_SUFFIX","actions","async","pendingPromise","Pending","stateManager","getInitialPromise","then","checkboxmanager","initCheckboxManager","catch","document","getElementById","addEventListener","setSectionSelection","submitAction","resolve","action","submitData","moduleIds","getSelectedModIds","length","displayError","Str","get_string","moveToTarget","value","trim","duplicateToTarget","JSON","stringify","submit","errorText","Promise","text","require","notification","alert"],"mappings":"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"}